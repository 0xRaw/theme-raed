{#

#}

{% extends "layouts.master" %}
{% block styles %}
    {# TODO:: Move To file #}
    <style>
        .cart-items-count span:after {
            content: ' x ';
        }
    </style>
    <link rel="stylesheet" href="{{ asset('/dist/filepond.css') }}">
{% endblock %}
{% block content %}
    <main id="main">
        <div class="container px-3 xs:px-5">
            <nav class="w-full py-5">
                {% component 'header.breadcrumbs' %}
            </nav>
            <div class="flex flex-col items-start lg:flex-row pb-6 lg:pb-20">
                <div class="main-content flex-1 w-full">
                    {% for item in items %}
                        {% set key_prefix=item.id %}
                        <section x-data="initCartItem({{ item.get('id', 'quantity', 'total', 'price', 'product_price', 'has_offer', 'offer')|json_encode }})"
                                 class="bg-white overflow-hidden p-5 xs:p-7 rounded-md mb-5 relative"
                                 id="item-{{ item.id }}" salla-form-data data-on-change="cart::update-item">
                            <input type="hidden" name="id" value="{{ item.id }}">
                            <!-- product -->
                            <div class="md:flex md:space-s-12 items-center justify-between mb-8">
                                <div class="flex flex-1 space-s-4">
                                    <a href="{{ item.url }}" class="flex-shrink-0">
                                        <img src="{{ item.product_image }}" alt="{{ item.product_name }}"
                                             class="flex-none w-24 h-20 border border-border-color bg-gray-100 rounded-md object-center object-cover">
                                    </a>
                                    <div class=" space-y-1">
                                        <h3 class="text-gray-900 leading-6">
                                            <a href="{{ item.url }}" class="text-base">{{ item.product_name }}</a>
                                        </h3>
                                        <span class="text-sm text-gray-400 line-through"
                                              x-text="productPrice"
                                              x-show="hasOffer"></span>
                                        <span :class="hasOffer?'text-theme-red':'text-sm text-gray-400'"
                                              x-text="itemPrice"></span>
                                        <i class="sicon-discount-calculator text-gray-400" x-show="hasOffer"></i>
                                        <span x-text="discountName" class="text-sm text-gray-400"
                                              x-show="hasOffer"></span>
                                    </div>
                                </div>

                                <div class="flex-1 border-t border-b border-border-color py-3 md:p-0 md:border-none mt-5 md:mt-1 flex justify-between items-center ">
                                    <div class="relative">
                                        <div class="flex items-center h-10 py-2 border  rounded-md text-sm transtion transition-color duration-300"
                                             :class="qtyValidation? 'has-error' : 'border-border-color' ">
                                            {% if item.is_donation %}
                                                <span>--</span>
                                            {% elseif item.hide_quantity or not item.is_available %}
                                                <input type="hidden" value="{{ item.quantity }}" name="quantity"/>
                                                <span>{{ item.quantity }}</span>
                                            {% else %}
                                                <button @click="addQty()"
                                                        class="text-gray-400 w-11 pe-0.5 focus:outline-none hover:text-primary transition-colors duration-300">
                                                    <i class="sicon-add"></i>
                                                </button>
                                                <input x-model="itemQty"
                                                       class="focus:outline-none focus:ring-transparent shadow-none h-6 border-t-0 border-b-0 border focus:border-border-color border-border-color font-bold px-2 text-center w-12 "
                                                       type="number"
                                                       value="{{ item.quantity }}"
                                                       @input.debounce.400ms="updateQty()"
                                                       data-max_quantity="{{ product.max_quantity }}"
                                                       max="{{ product.max_quantity }}"
                                                       data-quantity="{{ item.quantity }}"
                                                       data-digits="1"
                                                       name="quantity"
                                                       id="qty-{{ item.id }}"
                                                       min="1"
                                                >
                                                <button @click="subQty()"
                                                        class="text-gray-400 w-11 ps-0.5 focus:outline-none hover:text-primary transition-colors duration-300">
                                                    <i class="sicon-minus"></i>
                                                </button>
                                            {% endif %}
                                        </div>
                                        <small class="text-xs text-red-700 absolute mt-1"
                                               x-text="qtyValidation"></small>
                                    </div>

                                    <p class="text-primary flex-none font-bold text-sm">
                                        <span>{{ trans('pages.cart.total') }}:</span>
                                        {% if item.is_available %}
                                            <span x-text="itemTotal"></span>
                                        {% else %}
                                            <span x-text="'{{ trans('pages.cart.out_of_stock') }}'"></span>
                                        {% endif %}
                                    </p>
                                </div>
                            </div>

                            {% if item.has_options %}
                                <form>
                                    {% include 'pages.partials.product.fields' with {product:item} %}
                                </form>
                            {% endif %}
                            <button @click="removeItem()" data-delete-item="item-{{ item.id }}"
                                    class="remove-item-btn bg-red-400 hover:bg-red-500 transition-colors rounded-full text-white w-6 h-6 text-sm flex items-center justify-center absolute top-1.5 end-1.5 xs:top-5 xs:end-5">
		<span x-show="isRemoveItem" class="spinner-loader-wrap start-1 w-4 h-4 absolute">
		<span class="block -z-1 spinner-loader reverse w-4 h-4 animate-spin border-2 border-white rounded-full"></span></span>
                            </button>
                        </section>

                    {% else %}
                        <div class="h-full content-placeholder content-placeholder--cart text-gray-400 pt-36 pb-20 flex items-center flex-col justify-center">
                        <span class="rounded-icon w-36 h-36 bg-gray-bg mb-6">
                            <i class="sicon-shopping-bag text-6xl block text-reverse-dark"></i>
                        </span>
                            <p class="text-sm mb-5">{{ trans('pages.cart.empty_cart') }}</p>
                            <a href="{{ link('/') }}"
                               class="btn btn-outline-primary">{{ trans('common.elements.back_home') }}</a>
                        </div>
                    {% endfor %}
                </div>
                <!-- sidebar -->
                {% if items|length %}
                    <div x-data="initCart('{{ cart.id }}', '{{ cart.coupon }}')" x-cloak
                         class="sticky top-24 w-full lg:w-96  lg:ms-8">
                        {% component 'free-shipping' %}
                        <div
                                class="shadow-default bg-white p-5 xs:p-7 rounded-md mb-5 relative transition-height duration-1000">
                            <h4 class="font-bold text-sm mb-5">{{ trans('pages.cart.summary') }}</h4>
                            <div class="flex justify-between text-sm mb-5">
                                <span class="text-gray-400 cart-items-count">{{ pluralize("blocks.header.products_count", items|length|number)|raw }}</span>
                                <b>{{ cart.sub_total|money }}</b>
                            </div>
                            <div class="flex justify-between text-sm mb-5 shipping {{ cart.has_shipping_cost?'':'hidden' }}">
                                <span class="text-gray-400">{{ trans('pages.cart.shipping_cost') }}</span>
                                <b>{{ cart.real_shipping_cost|money }}</b>
                            </div>

                            {% if store.settings.cart.apply_coupon_enabled %}
                                <div class="border-t border-border-color border-b py-5 mb-5">
                                    <label for="couponCode"
                                           class="block text-sm ">{{ trans('pages.cart.have_coupon') }}</label>
                                    <div class="mt-2.5 relative">
                                        <input type="hidden" name="cart_id" value="{{ cart.id }}"/>
                                        <input type="text" value="{{ cart.coupon }}" @keyup="isShowCouponError = false"
                                               @keyup.enter="addCoupon()"
                                               placeholder="{{ trans('pages.cart.coupon_placeholder') }}"
                                               x-model="couponCode" id="couponCode" name="coupon"
                                               :class="{'has-error': isShowCouponError}" class="pe-24 form-input"
                                               :disabled="isShowCouponDiscount">
                                        <button @click="addCoupon();" type="button"
                                                class="coupon-btn absolute rounded-s-none rounded-e-md flex-shrink-0 btn"
                                                :class="isShowCouponDiscount ? 'btn-danger' : 'btn-default'">
                                            <span x-show="!isShowCouponDiscount">{{ trans('pages.cart.save_coupon') }}</span>
                                            <i x-show="isShowCouponDiscount" @click="removeCoupon();"
                                               class="sicon-cancel text-xl w-8"></i>
                                        </button>
                                    </div>
                                    <!-- error msg -->
                                    <span x-show="isShowCouponError" x-text="couponErrorMessage"
                                          class="text-xs text-red-700" id="validationHelp"></span>
                                </div>
                            {% endif %}

                            <!-- coupon discount -->
                            <div x-show="{{ cart.has_discount?"true":"false" }}"
                                 x-transition:enter="transition-height ease-out duration-300"
                                 x-transition:enter-start="opacity-0 transfor h-0"
                                 x-transition:enter-end="opacity-100 transform h-10"
                                 x-transition:leave="transition-height ease-in duration-300"
                                 x-transition:leave-start="opacity-100 transform h-10"
                                 x-transition:leave-end="opacity-0 transform h-0" class="flex justify-between text-sm">
                                <span class="text-gray-400 block  h-10">{{ trans('pages.cart.discount') }}</span>
                                <b>- {{ cart.real_discount|money }}</b>
                            </div>

                            <div class="flex justify-between text-sm mb-5">
                                <span class="text-gray-400">{{ trans('pages.cart.final_total') }}</span>
                                <b>{{ cart.total|money }}</b>
                            </div>
                            {% if store.settings.tax.taxable_prices_enabled %}
                                <div class="flex justify-between text-sm mb-5">
                                    <small class="text-gray-400">
                                        * {{ trans('pages.cart.prices_taxed') }}
                                    </small>
                                </div>
                            {% endif %}
                            <button class="w-full btn btn-primary" data-function="hasApplePay"
                                    data-on-click="cart::submit">
                                {{ trans('pages.cart.complete_order') }}
                            </button>
                        </div>
                    </div>

                    <div class="fixed md:hidden space-s-2 flex justify-center items-center bottom-0 start-0 rounded-t-large py-5 px-5 w-full text-center bg-white shadow-top z-50">
                        <span class="text-gray-400">{{ trans('pages.cart.final_total') }}:</span>
                        <b>{{ cart.total|money }}</b>
                    </div>
                {% endif %}
            </div>
        </div>
    </main>
{% endblock %}

{% block scripts %}
    <script>
        let cartItemsCount ={{ items|length }};
    </script>
    <script src="{{ asset('dist/cart.js') }}"></script>
{% endblock %}
