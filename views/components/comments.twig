{#
| Variable              | Type                       | Description         |
|-----------------------|----------------------------|---------------------|
| comments              | Feedback[] *Paginator      |                     |
| comments[].id         | int                        |                     |
| comments[].is_replay  | bool                       |                     |
| comments[].is_admin   | bool                       |                     |
| comments[].avatar     | string                     |                     |
| comments[].name       | string                     |                     |
| comments[].order_id   | ?int                       |                     |
| comments[].created_at | Date *Carbon               |                     |
| comments[].stars      | int                        |                     |
| comments[].content    | string                     |                     |
| comments[].status     | String "pending, approved" |                     |
| comments[].replies    | Feedback[] *Collection     |                     |
| can_comment           | bool                       |                     |
| type                  | string                     | page, product       |
| id                    | int                        | pageId or ProductId |
#}
<div class="{{ classes?classes:'bg-gray-100 mb-20 pt-20 pb-20' }}">
    <div class="container">
        {% if can_comment %}
            <div class="form form--add-comment" salla-form-data>
                {% honeypot %}
                <h2 class="mb-5 text-lg font-bold text-gray-500">{{ trans('blocks.comments.title') }}</h2>
                <textarea placeholder="{{ trans('blocks.comments.placeholder') }}"
                          class="form-input h-24 mb-5"
                          name="ask_textarea"
                          maxlength="500" cols="30"
                          rows="30"></textarea>

                <div class="text-end mb-4">
                    <button type="button" class="btn btn-primary inline-flex items-center justify-center"
                            id="add-new-comment-btn"
                            data-on-click="comment::{{ type }}-add"
                            data-id="{{ id }}">
                        <span class="loader loader--small"></span>
                        <span class="fix-align transition-transform duration-500 inline-block btn--text pointer-events-none">{{ trans('blocks.comments.submit') }}</span>
                    </button>
                </div>
            </div>
        {% endif %}

        {% if comments.count %}
            <div class="comments-container">
                <h2 class="text-lg font-bold text-gray-500 mb-8"> {{ pluralize('blocks.comments.comment', comments.total|number)|raw }}</h2>
                {% for comment in comments %}
                    {% if not comment.is_replay %}
                        <div class="border-b last:border-0 mb-8 pb-8 border-coolGray-200 comment-block">
                    {% endif %}
                    <div class="{% if comment.is_replay %} nested-comment reply md:ps-16 {% else %} comment {% endif %} flex text-sm space-s-3 comment_id_{{ comment.id }} {% if comment.is_admin %} admin {% endif %}">
                        {% if comment.is_replay %}
                            <i class="sicon-reply text-lg text-gray-400"></i>
                        {% endif %}
                        <div class="flex-none">
                            <img data-src="{{ comment.avatar }}" alt="{{ comment.name }}" src="{{asset('images/s-empty.png')}}" class="w-10 h-10 bg-gray-100 rounded-full lazy-load">
                        </div>

                        <div class="flex-1">
                            <div class="flex flex-wrap md:items-center justify-between mb-3 md:mb-0">
                                <div class="md:flex items-center">
                                    <h3 class="font-bold text-base me-5 fix-align mb-1">{{ comment.name }}</h3>
                                    <div class="flex">
                                        {% if comment.order_id %}
                                            <i class="sicon-check rounded-full bg-theme-yellow h-5 w-5 flex items-center justify-center text-xs "></i>
                                            <span class="fix-align ms-1 text-sm text-gray-400">
                                {{ trans('blocks.comments.has_bought') }}
                            </span>
                                        {% endif %}
                                        {% if comment.stars %}
                                            <span class="fix-align ms-1 text-sm text-gray-400">
                                {{ trans('pages.rating.rated') }}
                            </span>
                                        {% endif %}
                                    </div>
                                </div>
                                <p class="text-gray-400 text-sm">{{ comment.created_at|time_ago }}</p>
                                {% if comment.stars %}
                                    <div class="-mt-5 md:-mt-0 text-end md:text-start w-full comment__rating text-xs mb-2.5 space-x-1">
                                        <i class="sicon-star2 text-theme-yellow"></i>
                                        <i class="sicon-star2 {{ comment.stars >= 2 ? 'text-theme-yellow' : 'text-gray-400' }}"></i>
                                        <i class="sicon-star2 {{ comment.stars >= 3 ? 'text-theme-yellow' : 'text-gray-400' }}"></i>
                                        <i class="sicon-star2 {{ comment.stars >= 4 ? 'text-theme-yellow' : 'text-gray-400' }}"></i>
                                        <i class="sicon-star2 {{ comment.stars >= 5 ? 'text-theme-yellow' : 'text-gray-400' }}"></i>
                                    </div>
                                {% endif %}
                            </div>

                            <div class="prose prose-sm max-w-none text-gray-500">
                                <p>{{ comment.content|raw }}{% if comment.is_pending %} <span class="pending-comment">{{ trans('blocks.comments.waiting_approval') }}</span>{% endif %}
                                </p>
                                {% if comment.order_id != 0 %}
                                    <i class="icon-cart user-buy" data-toggle="tooltip" data-placement="right"
                                       title="{{ trans('blocks.comments.has_order') }}"></i>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% if not comment.is_replay and comment.replies %}
                        {% for replay in comment.replies %}
                            {% include _self with {comment:replay} %}
                        {% endfor %}
                        </div>
                    {% endif %}
                {% endfor %}
            </div>

            {% include 'pages.partials.loader-status' with {next_page:comments.next_page} %}
        {% endif %}
    </div>
</div>