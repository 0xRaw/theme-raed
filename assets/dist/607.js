"use strict";(self.webpackChunkTheme_One=self.webpackChunkTheme_One||[]).push([[607],{6705:(t,e,a)=>{a.d(e,{H:()=>l});var n=a(9794),r=a(9770),s=a(2885),i=a(4762),o=a(7523);salla.event.setMaxListeners(20);var l=new(function(t){(0,s.Z)(u,t);var e,a,l=(e=u,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,n=(0,o.Z)(e);if(a){var r=(0,o.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,i.Z)(this,t)});function u(){return(0,n.Z)(this,u),l.apply(this,arguments)}return(0,r.Z)(u,[{key:"setHost",value:function(t){this.host=t}},{key:"getElement",value:function(t){return this.host.querySelector(t)}},{key:"getAttribute",value:function(t,e){var a;return null===(a=this.getElement(t))||void 0===a?void 0:a.getAttribute(e)}},{key:"val",value:function(t){return this.getAttribute(t,"value")}},{key:"isUser",value:function(){return"user"===salla.config.get("user.type")}}]),u}(salla.AppHelpers))},2607:(t,e,a)=>{a.r(e),a.d(e,{salla_rating_modal:()=>c});var n=a(8957),r=a(9794),s=a(9770),i=a(9593),o=a.n(i),l=a(8946),u=a(6705),c=function(){function t(e){var a=this;(0,r.Z)(this,t),(0,l.r)(this,e),this.stepsCount=0,this.currentIndex=0,this.submitted=[],this.orderId=salla.config.get("page.id"),this.rate_the_store=salla.lang.get("pages.rating.rate_the_store"),this.write_store_rate=salla.lang.get("pages.rating.write_store_rate"),this.rate_product_stars=salla.lang.get("pages.rating.rate_product_stars"),this.write_product_rate=salla.lang.get("pages.rating.write_product_rate"),this.rate_shipping=salla.lang.get("pages.rating.rate_shipping"),this.write_shipping_rate=salla.lang.get("pages.rating.write_shipping_rate"),this.thanks=salla.lang.get("pages.rating.thanks"),this.back=salla.lang.get("common.elements.back"),this.next=salla.lang.get("common.elements.next"),u.H.setHost(this.host),salla.event.on("rating::show",(function(){return a.show()})),salla.event.on("languages::translations.loaded",(function(){a.rate_the_store=salla.lang.get("pages.rating.rate_the_store"),a.write_store_rate=salla.lang.get("pages.rating.write_store_rate"),a.rate_product_stars=salla.lang.get("pages.rating.rate_product_stars"),a.write_product_rate=salla.lang.get("pages.rating.write_product_rate"),a.rate_shipping=salla.lang.get("pages.rating.rate_shipping"),a.write_shipping_rate=salla.lang.get("pages.rating.write_shipping_rate"),a.thanks=salla.lang.get("pages.rating.thanks"),a.back=salla.lang.get("common.elements.back"),a.next=salla.lang.get("common.elements.next")}))}var e,a;return(0,s.Z)(t,[{key:"show",value:(a=(0,n.Z)(o().mark((function t(){var e=this;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.modal.show().then((function(){return e.order||salla.rating.api.order(e.orderId).then((function(t){return e.order=t.data}))})).then((function(){return e.modal.setTitle(salla.lang.get("pages.rating.rate_order")+' <span class="unicode">(#'+e.order.id+")</span>")})).then((function(){return e.modal.stopLoading()})).then((function(){return e.stepsCount=[e.order.testimonials_enabled,e.order.products_enabled,e.order.shipping_enabled].filter((function(t){return t})).length})).then((function(){return setTimeout((function(){return e.handleWizard()}),100)})));case 1:case"end":return t.stop()}}),t,this)}))),function(){return a.apply(this,arguments)})},{key:"hide",value:(e=(0,n.Z)(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.modal.hide());case 1:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"handleWizard",value:function(){this.steps=this.host.querySelectorAll(".s-rating-modal-step"),this.dots=this.host.querySelectorAll(".s-rating-modal-step-dot"),this.showActiveStep()}},{key:"showActiveStep",value:function(){var t,e=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.currentTab=a||this.steps[this.currentIndex],u.H.toggleClassIf(".s-rating-modal-step-dot","s-rating-modal-bg-gray","s-rating-modal-bg-primary",(function(t){return t!=e.dots[e.currentIndex]})).toggleClassIf(".s-rating-modal-step","s-rating-modal-active","s-rating-modal-hidden",(function(t){return t==e.currentTab})),0!=this.currentIndex&&(u.H.toggleElementClassIf(this.currentTab,"s-rating-modal-unactive","s-rating-modal-hidden",(function(){return!0})),setTimeout((function(){return u.H.toggleElementClassIf(e.currentTab,"s-rating-modal-active","s-rating-modal-unactive",(function(){return!0}))}),300));var n=null===(t=this.steps[this.currentIndex+1])||void 0===t?void 0:t.dataset.type;this.nextBtn.setText(n?salla.lang.get("pages.rating.rate")+" "+salla.lang.get("pages.rating."+n):salla.lang.get("pages.rating.send_ratings")),setTimeout((function(){var t;return e.body.setAttribute("style","height:"+(null===(t=e.currentTab)||void 0===t?void 0:t.scrollHeight)+"px")}))}},{key:"previousTab",value:function(){var t=this;this.currentIndex>0&&this.currentIndex--,u.H.toggleElementClassIf(this.backBtn,"s-rating-modal-unvisiable","block",(function(){return 0==t.currentIndex})),this.showActiveStep()}},{key:"submit",value:function(){var t=this;this.submittedBefore()||this.validate(),salla.config.canLeave=!1,this.nextBtn.load().then((function(){return t.submittedBefore()||t.sendFeedback()})).then((function(){return t.currentTab.querySelectorAll("[name],.s-rating-modal-btn-star").forEach((function(t){return t.setAttribute("disabled","")}))})).then((function(){return t.currentIndex<t.stepsCount&&t.currentIndex++})).then((function(){return t.showActiveStep()})).then((function(){return u.H.toggleClassIf("#prev-btn","block","s-rating-modal-unvisiable",(function(){return!0}))})).finally((function(){t.nextBtn.stop(),salla.config.canLeave=!0,t.currentIndex==t.stepsCount&&t.showThankYou(),t.modal.isClosable=!1}))}},{key:"submittedBefore",value:function(){return this.submitted.includes(this.currentIndex)}},{key:"validate",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!e&&"products"==this.currentTab.dataset.type)return this.currentTab.querySelectorAll(".rating-outer-form").forEach((function(e){return t.validate(e,"product")}));var n=(e=e||this.currentTab).querySelector(".rating_hidden_input").value,r=e.querySelector(".s-rating-modal-comment"),s=e.querySelector(".s-rating-modal-validation-msg");if(n&&r.value&&r.value.length>3)return r.classList.remove("s-has-error"),void(s.innerHTML="");throw a=a||e.dataset.type,u.H.toggleElementClassIf(r,"save","s-has-error",(function(t){return t.value.length>3})),s.innerHTML=n?salla.lang.get("common.errors.not_less_than_chars",{chars:4})+" "+r.getAttribute("placeholder"):salla.lang.get("pages.rating.rate_".concat(a,"_stars")).replace(" (:item)","")}},{key:"sendFeedback",value:function(){var t={};if(this.currentTab.querySelectorAll("[name]").forEach((function(e){var a=salla.helpers.inputData(e.name,e.value,t);t[a.name]=a.value})),0!=Object.keys(t).length)return t.order_id=this.orderId,t.type=this.currentTab.dataset.type,this.submitted.push(this.currentIndex),salla.rating.api[this.currentTab.dataset.type](t)}},{key:"showThankYou",value:function(){var t=this,e=10,a=setInterval((function(){t.thanksTime.innerHTML="00:0"+e--,e>0||(clearInterval(a),t.thanksTime.remove(),t.hide().then((function(){return window.location.reload()})))}),1e3);this.host.querySelector(".s-rating-modal-footer").classList.add("s-rating-modal-unvisiable"),this.showActiveStep(this.thanksTab)}},{key:"render",value:function(){var t=this;return(0,l.h)(l.e,{id:"s-rating"},(0,l.h)("salla-modal",{isLoading:!0,width:"md",ref:function(e){return t.modal=e}},this.order?[(0,l.h)("div",{class:"s-rating-modal-wrapper",ref:function(e){return t.body=e}},this.order.testimonials_enabled?(0,l.h)("div",{class:"rating-outer-form s-rating-modal-step-wrap s-rating-modal-step s-rating-modal-hidden","data-type":"store"},(0,l.h)("div",{class:"s-rating-modal-rounded-icon"},(0,l.h)("img",{src:salla.config.get("store.logo","https://assets.salla.sa/cp/assets/images/logo-new.png"),alt:"store name",class:"s-rating-modal-store-logo"})),(0,l.h)("h2",{class:"s-rating-modal-title"},this.rate_the_store),(0,l.h)("div",{class:"s-rating-modal-stars-company"},(0,l.h)("salla-rating-stars",{size:"large"})),(0,l.h)("textarea",{id:"storeReview",name:"comment",class:"s-rating-modal-comment",placeholder:this.write_store_rate}),(0,l.h)("small",{class:"s-rating-modal-validation-msg"})):"",this.order.products_enabled?(0,l.h)("section",{class:"s-rating-modal-step s-rating-modal-hidden","data-type":"products"},this.order.products.map((function(e,a){return(0,l.h)("div",{class:"rating-outer-form s-rating-modal-product","data-stars-error":t.rate_product_stars},(0,l.h)("div",{class:"s-rating-modal-product-img-wrap"},(0,l.h)("img",{src:e.product.thumbnail,alt:e.product.name,class:"s-rating-modal-product-img"})),(0,l.h)("div",{class:"s-rating-modal-product-details"},(0,l.h)("h3",{class:"s-rating-modal-product-title"}," ",e.product.name),(0,l.h)("div",{class:"s-rating-modal-stars-product"},(0,l.h)("salla-rating-stars",{size:"small",name:"products[".concat(a,"][rating]")})),(0,l.h)("input",{type:"hidden",name:"products[".concat(a,"][product_id]"),value:e.product.id}),(0,l.h)("textarea",{placeholder:t.write_product_rate,name:"products[".concat(a,"][comment]"),class:"s-rating-modal-comment"}),(0,l.h)("small",{class:"s-rating-modal-validation-msg"})))}))):"",this.order.shipping_enabled?(0,l.h)("div",{class:"rating-outer-form s-rating-modal-step-wrap s-rating-modal-step s-rating-modal-hidden","data-type":"shipping"},(0,l.h)("input",{type:"hidden",name:"shipping_company_id",value:this.order.shipping.company.id}),this.order.shipping.company.logo?(0,l.h)("div",{class:"s-rating-modal-rounded-icon"},(0,l.h)("img",{src:this.order.shipping.company.logo,class:"s-rating-modal-shipping-logo",alt:this.order.shipping.company.name})):(0,l.h)("span",{class:"s-rating-modal-icon sicon-shipping-fast"}),(0,l.h)("div",{class:"s-rating-modal-title"}," ",this.rate_shipping+" "+this.order.shipping.company.name),(0,l.h)("div",{class:"s-rating-modal-stars-company"},(0,l.h)("salla-rating-stars",{size:"large"})),(0,l.h)("textarea",{name:"comment",class:"s-rating-modal-comment",placeholder:this.write_shipping_rate}),(0,l.h)("small",{class:"s-rating-modal-validation-msg"})):"",(0,l.h)("div",{class:"s-rating-modal-thanks s-rating-modal-hidden",ref:function(e){return t.thanksTab=e}},(0,l.h)("span",{class:"s-rating-modal-icon sicon-check-circle2"}),(0,l.h)("h3",{class:"s-rating-modal-thanks-title"},this.thanks),(0,l.h)("div",{class:"s-rating-modal-thanks-msg",innerHTML:this.order.thanks_message}),(0,l.h)("time",{class:"s-rating-modal-thanks-time",ref:function(e){return t.thanksTime=e}}))),(0,l.h)("div",{class:"s-rating-modal-footer"},(0,l.h)("button",{ref:function(e){return t.backBtn=e},onClick:function(){return t.previousTab()},class:"s-rating-modal-btn s-rating-modal-unvisiable"},this.back),this.stepsCount>1?(0,l.h)("ul",{class:"s-rating-modal-dots"},[0,1,2].slice(0,this.stepsCount).map((function(){return(0,l.h)("li",{class:"s-rating-modal-bg-gray s-rating-modal-step-dot"})}))):"",(0,l.h)("salla-button",{"loader-position":"center",ref:function(e){return t.nextBtn=e},onClick:function(){return t.submit()}},this.next))]:""))}},{key:"componentDidLoad",value:function(){salla.event.dispatch("rating::ready",this)}},{key:"host",get:function(){return(0,l.g)(this)}}]),t}();c.style='#s-rating .s-rating-modal-product-img{font-size:0;position:relative}#s-rating .s-rating-modal-product-img:before{content:"";position:absolute;width:100%;height:100%;left:0;top:0;background:#eee}#s-rating .unicode{unicode-bidi:plaintext}'}}]);