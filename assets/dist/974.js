"use strict";(self.webpackChunkTheme_One=self.webpackChunkTheme_One||[]).push([[974],{2464:(t,e,a)=>{a.d(e,{H:()=>i});class s extends salla.AppHelpers{setHost(t){this.host=t}getElement(t){return this.host.querySelector(t)}getAttribute(t,e){var a;return null===(a=this.getElement(t))||void 0===a?void 0:a.getAttribute(e)}val(t){return this.getAttribute(t,"value")}isUser(){return"user"===salla.config.get("user.type")}}const i=new s},4974:(t,e,a)=>{a.r(e),a.d(e,{salla_rating:()=>r});var s=a(1208),i=a(2464);const r=class{constructor(t){(0,s.r)(this,t),this.isStoreRating=!1,this.isProductsRating=!1,this.isShippingRating=!1,this.ratingChain=Promise.resolve(),this.stepsCount=0,i.H.setHost(this.host),salla.event.on("rating::show",(()=>this.show()))}async show(){return this.modal.show().then((()=>salla.feedback.api.order(salla.get("page.id")))).then((t=>this.order=t.data)).then((()=>this.modal.setTitle(salla.lang.get("pages.rating.rate_order")+' <span class="unicode">(#'+this.order.id+")</span>"))).then((()=>this.modal.stopLoading())).then((()=>this.stepsCount=[this.order.testimonials_enabled,this.order.products_enabled,this.order.shipping_enabled].filter((t=>t)).length)).then((()=>setTimeout((()=>this.initiateRating()),100)))}async hide(){return this.modal.hide()}initiateRating(){this.handleWizard(),this.handleSubmitRating(),this.starsRating(),this.highlightSelectedStars()}handleWizard(){let t=0,e=this.host.querySelectorAll(".s-rating-step"),a=this.host.querySelectorAll(".s-rating-step-dot"),s=this.host.querySelector("#next-btn .s-button-text");this.setModalHeight(e[0]),this.showActiveStep(e,a,t,s),i.H.onClick("#prev-btn",(()=>{t>0&&t--,this.showActiveStep(e,a,t,s),0==t&&i.H.toggle("#prev-btn","s-rating-unvisiable","block",(()=>!0))})),i.H.onClick("#next-btn",(()=>{this.ratingValidation(),t==this.stepsCount-1?salla.event.dispatch("submit::order-rating"):(t<this.stepsCount-1&&t++,this.showActiveStep(e,a,t,s),i.H.toggle("#prev-btn","block","s-rating-unvisiable",(()=>!0)))}))}showActiveStep(t,e,a,s){var r;i.H.toggle(".s-rating-step","s-rating-hidden","s-rating-active",(()=>!0)),i.H.toggleElement(t[a],"s-rating-unactive","s-rating-hidden",(()=>!0)),setTimeout((()=>i.H.toggleElement(t[a],"s-rating-active","s-rating-unactive",(()=>!0))),200),i.H.toggle(".s-rating-step-dot","s-rating-bg-gray","s-rating-bg-primary",(()=>!0)),this.stepsCount>1&&i.H.toggleElement(e[a],"s-rating-bg-primary","s-rating-bg-gray",(()=>!0)),s.innerHTML=(null===(r=t[a+1])||void 0===r?void 0:r.dataset.stepName)||salla.lang.get("pages.rating.send_ratings"),this.setModalHeight(t[a])}setModalHeight(t){const e=this.host.querySelector(".s-rating-wrapper");setTimeout((()=>null==e?void 0:e.setAttribute("style","height:"+(null==t?void 0:t.scrollHeight)+"px")))}handleSubmitRating(){salla.event.on("submit::order-rating",(()=>this.sendRating().then((()=>{let t=this.host.querySelector(".s-rating-thanks"),e=10,a=setInterval((()=>{e--,this.host.querySelector(".s-rating-thanks-time").innerHTML=`00:0${e}`,0==e&&(this.hide(),clearInterval(a))}),1e3);i.H.toggle(".s-rating-step","s-rating-hidden","s-rating-active",(()=>!0)),this.host.querySelector(".s-rating-footer").classList.add("s-rating-unvisiable"),i.H.toggleElement(t,"s-rating-unactive","s-rating-hidden",(()=>!0)),setTimeout((()=>i.H.toggleElement(t,"s-rating-active","s-rating-unactive",(()=>!0))),200),this.setModalHeight(t)}))))}starsRating(){let t=["selected"];salla.document.event.onSubmit(".s-rating-stars-element",(function(e){e.preventDefault();var a=e.target.querySelectorAll(".s-rating-btn-star.hovered"),s=a[a.length-1];if(s){var i=parseInt(s.dataset.star,10);e.target.querySelector(".rating_hidden_input").value=i,e.target.querySelectorAll(".s-rating-btn-star").forEach((function(e,a){a<i?e.classList.add(...t):e.classList.remove(...t)}));var r=e.target.querySelector('.s-rating-btn-star[aria-pressed="true"]');r&&r.removeAttribute("aria-pressed"),s.setAttribute("aria-pressed",!0)}}))}highlightSelectedStars(){let t=["hovered"];i.H.all(".s-rating-stars-element",(e=>{let a=e.querySelectorAll(".s-rating-btn-star");e.addEventListener("mouseout",(()=>a.forEach((e=>e.classList.remove(...t))))),a.forEach(((e,s)=>{e.addEventListener("mouseover",(()=>{if(e.classList.add(...t),s<=1)"BUTTON"===e.previousElementSibling.tagName&&e.previousElementSibling.classList.add(...t);else for(let e=0;e<s;e++)a[e].classList.add(...t)})),e.addEventListener("mouseout",(()=>{e.classList.contains(...t)&&e.classList.remove(...t)}))}))}))}sendRating(){return i.H.all(".s-rating-step",(t=>{let e=t.dataset.type,a=[];t.querySelectorAll(".rating-outer-form").forEach((t=>{let s={};t.querySelectorAll("[name]").forEach((function(t){let e=salla.helpers.inputData(t.name,t.value,s);s[e.name]=e.value})),a=[],a.push(s),this.sendFeedback(e,a)}))})),this.ratingChain}sendFeedback(t,e){e&&0!=e.length&&(this.nextBtn.load(),salla.config.canLeave=!1,this.ratingChain=salla.feedback.api[t](e[0]).then((function(){salla.config.canLeave=!0})).catch((()=>salla.config.canLeave=!0)))}ratingValidation(){let t="";if(document.querySelectorAll(".s-rating-step.s-rating-active").forEach((e=>{e.querySelectorAll(".rating-outer-form").forEach((e=>{let a=e.querySelector(".rating_hidden_input"),s=e.querySelector(".s-rating-comment"),i=e.querySelector(".s-rating-validation-msg");if(a.value&&s.value&&s.value.length>3)return s.classList.remove("s-rating-has-error"),void(i.innerHTML="");s.value&&s.value.length>3?s.classList.remove("s-rating-has-error"):s.classList.add("s-rating-has-error"),t=a.value?salla.lang.get("common.errors.not_less_than_chars",{chars:4})+" "+s.getAttribute("placeholder"):e.dataset.starsError||salla.lang.get("pages.rating.rate_store_stars"),i.innerHTML=t}))})),t)throw new Error(t)}renderStoreRating(){return(0,s.h)("section",{class:"s-rating-step","data-type":"store","data-step-name":salla.lang.get("pages.rating.rate")+" "+salla.lang.get("pages.rating.store")},(0,s.h)("div",{class:"rating-outer-form s-rating-step-wrap","data-stars-error":salla.lang.get("pages.rating.rate_store_stars")},(0,s.h)("input",{type:"hidden",name:"order_id",value:this.order.id}),(0,s.h)("input",{type:"hidden",name:"type",value:"store"}),(0,s.h)("div",{class:"s-rating-rounded-icon"},(0,s.h)("img",{src:salla.get("store.logo"),alt:"store name",class:"s-rating-store-logo"})),(0,s.h)("h2",{class:"s-rating-title"},salla.lang.get("pages.rating.rate_the_store")),(0,s.h)("div",{class:"s-rating-stars-company"}," ",this.getStarsRating("large")),(0,s.h)("textarea",{id:"storeReview",name:"comment",class:"s-rating-comment",placeholder:salla.lang.get("pages.rating.write_store_rate")}),(0,s.h)("small",{class:"s-rating-validation-msg"})))}renderShippingRating(){return(0,s.h)("section",{class:"s-rating-step","data-type":"shipping","data-step-name":salla.lang.get("pages.rating.rate")+" "+salla.lang.get("pages.rating.shipping")},(0,s.h)("div",{class:"rating-outer-form s-rating-step-wrap","data-stars-error":salla.lang.get("pages.rating.rate_shipping_stars")},(0,s.h)("input",{type:"hidden",name:"order_id",value:this.order.id}),(0,s.h)("input",{type:"hidden",name:"shipping_company_id",value:this.order.shipping.company.id}),(0,s.h)("input",{type:"hidden",name:"type",value:"shipping"}),(0,s.h)("div",{class:"s-rating-rounded-icon"},(0,s.h)("img",{src:this.order.shipping.company.logo,alt:"company name",class:"s-rating-shipping-logo"})),(0,s.h)("h2",{class:"s-rating-title"}," ",salla.lang.get("pages.rating.rate_shipping")+" "+this.order.shipping.company.name),(0,s.h)("div",{class:"s-rating-stars-company"}," ",this.getStarsRating("large")),(0,s.h)("textarea",{id:"shippingReview",name:"comment",class:"s-rating-comment",placeholder:salla.lang.get("pages.rating.write_shipping_rate")}),(0,s.h)("small",{class:"s-rating-validation-msg"})))}renderProductsRating(){return(0,s.h)("section",{class:"s-rating-step","data-type":"product","data-step-name":salla.lang.get("pages.rating.rate")+" "+salla.lang.get("pages.rating.products")},this.order.products.map(((t,e)=>(0,s.h)("div",{class:"rating-outer-form s-rating-product","data-stars-error":salla.lang.get("pages.rating.rate_product_stars")},(0,s.h)("img",{src:t.product.thumbnail,alt:t.product.name,class:"s-rating-product-img"}),(0,s.h)("div",{class:"s-rating-product-details"},(0,s.h)("h3",{class:"s-rating-product-title"}," ",t.product.name),(0,s.h)("div",{class:"s-rating-stars-product"}," ",this.getStarsRating("small")),(0,s.h)("input",{type:"hidden",name:"order_id",value:this.order.id}),(0,s.h)("input",{type:"hidden",name:`products[${e}][product_id]`,value:t.product.id}),(0,s.h)("input",{type:"hidden",name:"type",value:"products"}),(0,s.h)("textarea",{"data-product-id":t.product.id,name:`products[${e}][comment]`,id:`productReview_${t.product.id}`,class:"s-rating-comment",placeholder:salla.lang.get("pages.rating.write_product_rate")}),(0,s.h)("small",{class:"s-rating-validation-msg"}))))))}renderThanksView(){return(0,s.h)("div",{class:"s-rating-thanks s-rating-hidden"},(0,s.h)("span",{class:"s-rating-thanks-icon sicon-check-circle2"}),(0,s.h)("h3",{class:"s-rating-thanks-title"},salla.lang.get("pages.rating.thanks")),(0,s.h)("div",{class:"s-rating-thanks-msg",innerHTML:this.thanksMsg}),(0,s.h)("a",{href:"#!",onClick:()=>this.hide(),class:"s-rating-thanks-btn"},"عودة إلي تفاصيل الطلب"),(0,s.h)("time",{class:"s-rating-thanks-time"}))}getStarsRating(t){return(0,s.h)("form",{class:"s-rating-stars-element"},(0,s.h)("input",{type:"hidden",class:"rating_hidden_input",name:"rating",value:""}),[1,2,3,4,5].map((e=>(0,s.h)("button",{type:"submit",class:"s-rating-btn-star s-rating-btn-star-"+t,"data-star":e},(0,s.h)("i",{class:"sicon-star2"})))))}render(){return(0,s.h)(s.e,null,(0,s.h)("salla-modal",{isLoading:!0,width:"md",ref:t=>this.modal=t},this.order?[(0,s.h)("div",{class:"s-rating-wrapper "},this.order.testimonials_enabled&&this.renderStoreRating(),this.order.products_enabled&&this.renderProductsRating(),this.order.shipping_enabled&&this.renderShippingRating(),this.renderThanksView()),(0,s.h)("div",{class:"s-rating-footer"},(0,s.h)("button",{id:"prev-btn",class:"s-rating-btn s-rating-unvisiable"},salla.lang.get("common.elements.back")),this.stepsCount>1?(0,s.h)("ul",{class:"s-rating-dots"},[0,1,2].slice(0,this.stepsCount).map((t=>(0,s.h)("li",{class:(0==t?"s-rating-bg-primary":"s-rating-bg-gray")+" s-rating-step-dot"})))):"",(0,s.h)("salla-button",{id:"next-btn",ref:t=>this.nextBtn=t},"التالي"))]:""))}componentDidRender(){this.modal.querySelectorAll("[hidden]").forEach((t=>t.removeAttribute("hidden")))}get host(){return(0,s.g)(this)}};r.style=":host{display:block}.unicode{unicode-bidi:plaintext}"}}]);