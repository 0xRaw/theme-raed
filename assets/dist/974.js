"use strict";(self.webpackChunkTheme_One=self.webpackChunkTheme_One||[]).push([[974],{2464:(t,e,s)=>{s.d(e,{H:()=>r});class a extends salla.AppHelpers{setHost(t){this.host=t}getElement(t){return this.host.querySelector(t)}getAttribute(t,e){var s;return null===(s=this.getElement(t))||void 0===s?void 0:s.getAttribute(e)}val(t){return this.getAttribute(t,"value")}isUser(){return"user"===salla.config.get("user.type")}}const r=new a},4974:(t,e,s)=>{s.r(e),s.d(e,{salla_rating:()=>i});var a=s(1208),r=s(2464);const i=class{constructor(t){(0,a.r)(this,t),this.isStoreRating=!1,this.isProductsRating=!1,this.isShippingRating=!1,this.stepsCount=0,this.currentIndex=0,r.H.setHost(this.host),salla.event.on("rating::show",(()=>this.show()))}async show(){return this.modal.show().then((()=>salla.feedback.api.order(salla.get("page.id")))).then((t=>this.order=t.data)).then((()=>this.modal.setTitle(salla.lang.get("pages.rating.rate_order")+' <span class="unicode">(#'+this.order.id+")</span>"))).then((()=>this.modal.stopLoading())).then((()=>this.stepsCount=[this.order.testimonials_enabled,this.order.products_enabled,this.order.shipping_enabled].filter((t=>t)).length)).then((()=>setTimeout((()=>this.initiateRating()),100)))}async hide(){return this.modal.hide()}initiateRating(){this.handleWizard(),this.starsRating(),this.highlightSelectedStars()}handleWizard(){this.steps=this.host.querySelectorAll(".s-rating-step"),this.dots=this.host.querySelectorAll(".s-rating-step-dot"),this.showActiveStep(),r.H.onClick("#prev-btn",(t=>{r.H.toggleElement(t.target,"s-rating-unvisiable","block",(()=>0==this.currentIndex)),this.currentIndex>0&&this.currentIndex--,this.showActiveStep()}))}showActiveStep(t=null){var e;this.currentTab=t||this.steps[this.currentIndex],r.H.toggle(".s-rating-step","s-rating-active","s-rating-hidden",(t=>t==this.currentTab)).toggle(".s-rating-step-dot","s-rating-bg-gray","s-rating-bg-primary",(t=>t!=this.dots[this.currentIndex])),r.H.toggleElement(this.currentTab,"s-rating-unactive","s-rating-hidden",(()=>!0)),setTimeout((()=>r.H.toggleElement(this.currentTab,"s-rating-active","s-rating-unactive",(()=>!0))),300);let s=null===(e=this.steps[this.currentIndex+1])||void 0===e?void 0:e.dataset.type;this.nextBtn.querySelector(".s-button-text").innerHTML=s?salla.lang.get("pages.rating.rate")+" "+salla.lang.get("pages.rating."+s):salla.lang.get("pages.rating.send_ratings"),setTimeout((()=>{var t;return this.body.setAttribute("style","height:"+(null===(t=this.currentTab)||void 0===t?void 0:t.scrollHeight)+"px")}))}starsRating(){let t=["selected"];salla.document.event.onSubmit(".s-rating-stars-element",(function(e){e.preventDefault();let s=e.target.querySelectorAll(".s-rating-btn-star.hovered"),a=s[s.length-1];if(!a)return;let r=parseInt(a.dataset.star,10);e.target.querySelector(".rating_hidden_input").value=r,e.target.querySelectorAll(".s-rating-btn-star").forEach((function(e,s){s<r?e.classList.add(...t):e.classList.remove(...t)}));var i=e.target.querySelector('.s-rating-btn-star[aria-pressed="true"]');i&&i.removeAttribute("aria-pressed"),a.setAttribute("aria-pressed",!0)}))}highlightSelectedStars(){let t=["hovered"];r.H.all(".s-rating-stars-element",(e=>{let s=e.querySelectorAll(".s-rating-btn-star");e.addEventListener("mouseout",(()=>s.forEach((e=>e.classList.remove(...t))))),s.forEach(((e,a)=>{e.addEventListener("mouseover",(()=>{if(e.classList.add(...t),a<=1)"BUTTON"===e.previousElementSibling.tagName&&e.previousElementSibling.classList.add(...t);else for(let e=0;e<a;e++)s[e].classList.add(...t)})),e.addEventListener("mouseout",(()=>e.classList.remove(...t)))}))}))}sendFeedback(t=null,e=null){if(!t&&"products"===this.currentTab.dataset.type){let t=Array.from(this.currentTab.querySelectorAll(".rating-outer-form")),e=this.sendFeedback(t[0],"product");return t.slice(1).forEach((t=>e.then((()=>this.sendFeedback(t,"product"))))),e}e=e||this.currentTab.dataset.type,t=t||this.currentTab;let s={};if(t.querySelectorAll("[name]").forEach((t=>{let e=salla.helpers.inputData(t.name,t.value,s);s[e.name]=e.value})),0!=Object.keys(s).length)return s.order_id=this.order.id,s.type=this.currentTab.dataset.type,salla.feedback.api[e](s)}submit(){this.validate(),this.currentIndex!=this.stepsCount-1?(salla.config.canLeave=!1,this.nextBtn.load().then((()=>this.sendFeedback())).then((()=>this.currentIndex<this.stepsCount-1&&this.currentIndex++)).then((()=>this.showActiveStep())).then((()=>r.H.toggle("#prev-btn","block","s-rating-unvisiable",(()=>!0)))).finally((()=>this.nextBtn.stop()&&(salla.config.canLeave=!0)))):this.showThankYou()}validate(t=null,e=null){if(!t&&"products"==this.currentTab.dataset.type)return this.currentTab.querySelectorAll(".rating-outer-form").forEach((t=>this.validate(t,"product")));let s=(t=t||this.currentTab).querySelector(".rating_hidden_input").value,a=t.querySelector(".s-rating-comment"),i=t.querySelector(".s-rating-validation-msg");if(s&&a.value&&a.value.length>3)return a.classList.remove("s-rating-has-error"),void(i.innerHTML="");throw e=e||t.dataset.type,r.H.toggleElement(a,"save","s-rating-has-error",(t=>t.value.length>3)),i.innerHTML=s?salla.lang.get("common.errors.not_less_than_chars",{chars:4})+" "+a.getAttribute("placeholder"):salla.lang.get(`pages.rating.rate_${e}_stars`).replace(" (:item)","")}showThankYou(){let t=10,e=setInterval((()=>{this.thanksTime.innerHTML="00:0"+t--,t<0&&this.hide()&&clearInterval(e)}),1e3);this.host.querySelector(".s-rating-footer").classList.add("s-rating-unvisiable"),this.showActiveStep(this.thanksTab)}renderStoreRating(){return this.order.testimonials_enabled?(0,a.h)("div",{class:"rating-outer-form s-rating-step-wrap s-rating-step","data-type":"store"},(0,a.h)("div",{class:"s-rating-rounded-icon"},(0,a.h)("img",{src:salla.get("store.logo"),alt:"store name",class:"s-rating-store-logo"})),(0,a.h)("h2",{class:"s-rating-title"},salla.lang.get("pages.rating.rate_the_store")),(0,a.h)("div",{class:"s-rating-stars-company"}," ",this.getStarsRating("large")),(0,a.h)("textarea",{id:"storeReview",name:"comment",class:"s-rating-comment",placeholder:salla.lang.get("pages.rating.write_store_rate")}),(0,a.h)("small",{class:"s-rating-validation-msg"})):""}renderShippingRating(){return this.order.shipping_enabled?(0,a.h)("div",{class:"rating-outer-form s-rating-step-wrap s-rating-step","data-type":"shipping"},(0,a.h)("input",{type:"hidden",name:"shipping_company_id",value:this.order.shipping.company.id}),(0,a.h)("div",{class:"s-rating-rounded-icon"},(0,a.h)("img",{src:this.order.shipping.company.logo,alt:"company name",class:"s-rating-shipping-logo"})),(0,a.h)("h2",{class:"s-rating-title"}," ",salla.lang.get("pages.rating.rate_shipping")+" "+this.order.shipping.company.name),(0,a.h)("div",{class:"s-rating-stars-company"}," ",this.getStarsRating("large")),(0,a.h)("textarea",{name:"comment",class:"s-rating-comment",placeholder:salla.lang.get("pages.rating.write_shipping_rate")}),(0,a.h)("small",{class:"s-rating-validation-msg"})):""}renderProductsRating(){return this.order.products_enabled?(0,a.h)("section",{class:"s-rating-step","data-type":"products"},this.order.products.map(((t,e)=>(0,a.h)("div",{class:"rating-outer-form s-rating-product","data-stars-error":salla.lang.get("pages.rating.rate_product_stars")},(0,a.h)("img",{src:t.product.thumbnail,alt:t.product.name,class:"s-rating-product-img"}),(0,a.h)("div",{class:"s-rating-product-details"},(0,a.h)("h3",{class:"s-rating-product-title"}," ",t.product.name),(0,a.h)("div",{class:"s-rating-stars-product"}," ",this.getStarsRating("small")),(0,a.h)("input",{type:"hidden",name:`products[${e}][id]`,value:t.product.id}),(0,a.h)("textarea",{placeholder:salla.lang.get("pages.rating.write_product_rate"),name:`products[${e}][comment]`,class:"s-rating-comment"}),(0,a.h)("small",{class:"s-rating-validation-msg"})))))):""}renderThanksView(){return(0,a.h)("div",{class:"s-rating-thanks s-rating-hidden",ref:t=>this.thanksTab=t},(0,a.h)("span",{class:"s-rating-thanks-icon sicon-check-circle2"}),(0,a.h)("h3",{class:"s-rating-thanks-title"},salla.lang.get("pages.rating.thanks")),(0,a.h)("div",{class:"s-rating-thanks-msg",innerHTML:this.thanksMsg}),(0,a.h)("a",{href:"#!",onClick:()=>this.hide(),class:"s-rating-thanks-btn"},"عودة إلي تفاصيل الطلب"),(0,a.h)("time",{class:"s-rating-thanks-time",ref:t=>this.thanksTime=t}))}getStarsRating(t){return(0,a.h)("form",{class:"s-rating-stars-element"},(0,a.h)("input",{type:"hidden",class:"rating_hidden_input",name:"rating",value:""}),[1,2,3,4,5].map((e=>(0,a.h)("button",{type:"submit",class:"s-rating-btn-star s-rating-btn-star-"+t,"data-star":e},(0,a.h)("i",{class:"sicon-star2"})))))}render(){return(0,a.h)(a.e,null,(0,a.h)("salla-modal",{isLoading:!0,width:"md",ref:t=>this.modal=t},this.order?[(0,a.h)("div",{class:"s-rating-wrapper",ref:t=>this.body=t},this.renderStoreRating(),this.renderProductsRating(),this.renderShippingRating(),this.renderThanksView()),(0,a.h)("div",{class:"s-rating-footer"},(0,a.h)("button",{id:"prev-btn",class:"s-rating-btn s-rating-unvisiable"},salla.lang.get("common.elements.back")),this.stepsCount>1?(0,a.h)("ul",{class:"s-rating-dots"},[0,1,2].slice(0,this.stepsCount).map((()=>(0,a.h)("li",{class:"s-rating-bg-gray s-rating-step-dot"})))):"",(0,a.h)("salla-button",{ref:t=>this.nextBtn=t,onClick:()=>this.submit()},salla.lang.get("common.elements.next")))]:""))}componentDidRender(){this.modal.querySelectorAll("[hidden]").forEach((t=>t.removeAttribute("hidden")))}get host(){return(0,a.g)(this)}};i.style=":host{display:block}.unicode{unicode-bidi:plaintext}"}}]);