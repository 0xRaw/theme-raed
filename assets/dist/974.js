"use strict";(self.webpackChunkTheme_One=self.webpackChunkTheme_One||[]).push([[974],{8825:(t,e,s)=>{s.d(e,{H:()=>i});class a extends salla.AppHelpers{setHost(t){this.host=t}getElement(t){return this.host.querySelector(t)}getAttribute(t,e){var s;return null===(s=this.getElement(t))||void 0===s?void 0:s.getAttribute(e)}val(t){return this.getAttribute(t,"value")}isUser(){return!!salla.config.is_user}}const i=new a},4974:(t,e,s)=>{s.r(e),s.d(e,{salla_rating:()=>r});var a=s(4634),i=s(8825);const r=class{constructor(t){(0,a.r)(this,t),this.order={shipping:{id:5622},products:[{title:"ميكروفون عالى الجودة",image:"https://salla-dev.s3.eu-central-1.amazonaws.com/Mvyk/pMdEEyMVpZFj4L1Hrdm2g48AuiSx0TrKULBiOnPo.jpg",price:"‏10,978.00 ر.س",qty:"‏2",totalBefore:"‏1120 ر.س",discount:"-5%",total:"‏1064 ر.س",id:"2314513454",getOptimusRouteKey:"7351233357"},{title:"ميكروفون عالى الجودة",image:"https://salla-dev.s3.eu-central-1.amazonaws.com/Mvyk/pMdEEyMVpZFj4L1Hrdm2g48AuiSx0TrKULBiOnPo.jpg",price:"‏10,978.00 ر.س",qty:"‏2",totalBefore:"‏1120 ر.س",discount:"-5%",total:"‏1064 ر.س",id:"2314513454",getOptimusRouteKey:"7351233357"},{title:"ساعة ذكية بنظام اندرويد",image:"https://salla-dev.s3.eu-central-1.amazonaws.com/Mvyk/T4kTqYNuPAZmPMLw1bx92RnjVMZyFszVXOUZQsFJ.jpg",price:"‏10,978.00 ر.س",qty:"‏2",totalBefore:"‏1120 ر.س",discount:"-5%",total:"‏1064 ر.س",id:"679822376",getOptimusRouteKey:"73233357"}],storeLogo:"https://salla-dev.s3.eu-central-1.amazonaws.com/Mvyk/X3NKcY7nhaFQlR7kBBHvfDpMY48cerunKrmDA1gi.png",shippingLogo:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcScPt4R6KaKDldrXb-9pUljFwL3m6A72BhN6p1qZJKprwC6VbCWC_8ASZgiJAoL_l7DepM&usqp=CAU"},this.ratingChain=Promise.resolve(),this.stepsCount=0,i.H.setHost(this.host)}async show(){return this.modal.show()}async hide(){return this.modal.hide()}componentWillLoad(){this.stepsCount=[this.isStoreRating,this.isProductsRating,this.isShippingRating].filter((t=>t)).length}componentDidRender(){this.show(),this.initiateRating()}initiateRating(){this.starsRating(),this.highlightSelectedStars(),this.handleWizard(),salla.event.on("submit::order-rating",(()=>this.sendRating().then((()=>{let t=10,e=setInterval((()=>{t--,this.host.querySelector(".s-rating-thanks-time").innerHTML=`00:0${t}`,0==t&&clearInterval(e)}),1e3);this.host.querySelector(".s-rating-footer").classList.add("s-rating-unvisiable"),i.H.toggle(".s-rating-step","s-rating-hidden","s-rating-active",(()=>!0)),i.H.toggle(".s-rating-thanks","s-rating-unactive","s-rating-hidden",(()=>!0));const s=this.host.querySelector(".s-rating-thanks");this.setModalHeight(s),setTimeout((()=>{i.H.toggleElement(s,"s-rating-active","s-rating-unactive",(()=>!0))}),200)}))))}getData(){salla.api.order.endpointsMethods.details="get",salla.order.api.details(salla.config.page.id).then((t=>console.log("")))}handleWizard(){var t;let e=0,s=this.host.querySelectorAll(".s-rating-step"),a=this.host.querySelectorAll(".s-rating-step-dot"),r=this.host.querySelector("#next-btn .btn-text");this.setModalHeight(s[0]),this.showActiveStep(s,a,e),r.innerHTML=(null===(t=s[e+1])||void 0===t?void 0:t.dataset.stepName)||"إرسال التقييم",i.H.onClick("#prev-btn",(()=>{var t;e>0&&e--,this.showActiveStep(s,a,e),r.innerHTML=(null===(t=s[e+1])||void 0===t?void 0:t.dataset.stepName)||"إرسال التقييم",0==e&&i.H.toggle("#prev-btn","s-rating-unvisiable","block",(()=>!0))})),i.H.onClick("#next-btn",(()=>{var t;this.ratingValidation(),e==this.stepsCount-1?salla.event.dispatch("submit::order-rating"):(e<this.stepsCount-1&&e++,this.showActiveStep(s,a,e),r.innerHTML=(null===(t=s[e+1])||void 0===t?void 0:t.dataset.stepName)||"إرسال التقييم",i.H.toggle("#prev-btn","block","s-rating-unvisiable",(()=>!0)))}))}showActiveStep(t,e,s){i.H.toggle(".s-rating-step-dot","bg-gray-200","bg-primay",(()=>!0)),this.stepsCount>1&&i.H.toggleElement(e[s],"bg-primary","bg-gray-200",(()=>!0)),i.H.toggle(".s-rating-step","s-rating-hidden","s-rating-active",(()=>!0)),i.H.toggleElement(t[s],"block","s-rating-hidden",(()=>!0)),this.setModalHeight(t[s]),setTimeout((()=>{i.H.toggleElement(t[s],"s-rating-active","s-rating-unactive",(()=>!0))}),200)}setModalHeight(t){const e=this.host.querySelector(".s-rating-wrapper");setTimeout((()=>{null==e||e.setAttribute("style","height:"+(null==t?void 0:t.scrollHeight)+"px")}))}starsRating(){let t=["selected","text-theme-yellow"];salla.document.event.onSubmit(".s-rating-stars-element",(function(e){e.preventDefault();var s=e.target.querySelectorAll(".btn--star.hovered"),a=s[s.length-1];if(a){var i=parseInt(a.dataset.star,10);e.target.querySelector(".rating_hidden_input").value=i,e.target.querySelectorAll(".btn--star").forEach((function(e,s){s<i?e.classList.add(...t):e.classList.remove(...t)}));var r=e.target.querySelector('.star[aria-pressed="true"]');r&&r.removeAttribute("aria-pressed"),a.setAttribute("aria-pressed",!0)}}))}highlightSelectedStars(){let t=["hovered","text-theme-yellow"];i.H.all(".s-rating-stars-element",(e=>{let s=e.querySelectorAll(".btn--star");e.addEventListener("mouseout",(()=>e.querySelectorAll(".btn--star").forEach((e=>e.classList.remove(...t))))),s.forEach(((e,a)=>{e.addEventListener("mouseover",(()=>{if(e.classList.add(...t),a<=1)"BUTTON"===e.previousElementSibling.tagName&&e.previousElementSibling.classList.add(...t);else for(let e=0;e<a;e++)s[e].classList.add(...t)})),e.addEventListener("mouseout",(()=>{e.classList.contains(...t)&&e.classList.remove(...t)}))}))}))}sendRating(){return i.H.all(".s-rating-step",(t=>{let e=t.dataset.type,s=[];t.querySelectorAll(".rating-outer-form").forEach((t=>{let a={};t.querySelectorAll("[name]").forEach((function(t){let e=salla.helpers.inputData(t.name,t.value,a);a[e.name]=e.value})),s=[],s.push(a),this.sendFeedback(e,s)}))})),this.ratingChain}sendFeedback(t,e){e&&0!=e.length&&(this.nextBtn.load(),salla.config.canLeave=!1,this.ratingChain=salla.feedback.api[t](e[0]).then((function(){salla.config.canLeave=!0})).catch((()=>salla.config.canLeave=!0)))}ratingValidation(){let t="";if(document.querySelectorAll(".s-rating-step.s-rating-active").forEach((e=>{e.querySelectorAll(".rating-outer-form").forEach((e=>{let s=e.querySelector(".rating_hidden_input"),a=e.querySelector(".s-rating-comment"),i=e.querySelector(".s-rating-validation-msg");if(s.value&&a.value&&a.value.length>3)return a.classList.remove("has-error"),void(i.innerHTML="");a.value&&a.value.length>3?a.classList.remove("has-error"):a.classList.add("has-error"),t=s.value?salla.lang.get("common.errors.not_less_than_chars",{chars:4})+" "+a.getAttribute("placeholder"):e.dataset.starsError||salla.lang.get("pages.rating.rate_store_stars"),i.innerHTML=t}))})),t){let e=document.querySelectorAll(".has-error");if(e.length){let t=e[0].offsetTop;window.scrollTo({top:t-80})}throw new Error(t)}}render(){return(0,a.h)(a.e,null,(0,a.h)("salla-modal",{class:"hidden","modal-width":"w-[800px]",ref:t=>this.modal=t,title:salla.lang.get("pages.rating.rate_order")+' <span class="unicode">(#'+this.orderId+")</span>"},(0,a.h)("div",{class:"s-rating-wrapper "},this.isStoreRating&&this.renderStoreRating(),this.isProductsRating&&this.renderProductsRating(),this.isShippingRating&&this.renderShippingRating(),this.renderThanksView()),(0,a.h)("div",{class:"s-rating-footer"},(0,a.h)("button",{id:"prev-btn",class:"s-rating-btn s-rating-unvisiable"},"السابق"),this.stepsCount>1?(0,a.h)("ul",{class:"s-rating-dots"},[0,1,2].slice(0,this.stepsCount).map((t=>(0,a.h)("li",{class:(0==t?"bg-primary":"bg-gray-200")+" s-rating-step-dot"})))):"",(0,a.h)("salla-button",{id:"next-btn",class:"w-28",ref:t=>this.nextBtn=t},"التالي"))))}renderStoreRating(){return(0,a.h)("section",{class:"s-rating-step","data-type":"store","data-step-name":"تقييم المتجر"},(0,a.h)("div",{class:"rating-outer-form s-rating-step-wrap","data-stars-error":salla.lang.get("pages.rating.rate_store_stars")},(0,a.h)("input",{type:"hidden",name:"order_id",value:this.orderId}),(0,a.h)("input",{type:"hidden",name:"type",value:"store"}),(0,a.h)("div",{class:"s-rating-rounded-icon"},(0,a.h)("img",{src:this.order.storeLogo,alt:"store name",class:"s-rating-store-logo"})),(0,a.h)("h2",{class:"s-rating-title"},salla.lang.get("pages.rating.rate_the_store")),this.getStarsRating(),(0,a.h)("textarea",{id:"storeReview",name:"comment",class:"s-rating-comment",placeholder:salla.lang.get("pages.rating.write_store_rate")}),(0,a.h)("small",{class:"s-rating-validation-msg"})))}renderShippingRating(){return(0,a.h)("section",{class:"s-rating-step","data-type":"shipping","data-step-name":"تقييم شركة الشحن"},(0,a.h)("div",{class:"rating-outer-form s-rating-step-wrap","data-stars-error":salla.lang.get("pages.rating.rate_shipping_stars")},(0,a.h)("input",{type:"hidden",name:"order_id",value:this.orderId}),(0,a.h)("input",{type:"hidden",name:"shipping_company_id",value:this.order.shipping.id}),(0,a.h)("input",{type:"hidden",name:"type",value:"shipping"}),(0,a.h)("div",{class:"s-rating-rounded-icon"},(0,a.h)("img",{src:this.order.shippingLogo,alt:"company name",class:"s-rating-shipping-logo"})),(0,a.h)("h2",{class:"s-rating-title"}," ",salla.lang.get("pages.rating.rate_shipping")," ارامكس"),this.getStarsRating(),(0,a.h)("textarea",{id:"shippingReview",name:"comment",class:"s-rating-comment",placeholder:salla.lang.get("pages.rating.write_shipping_rate")}),(0,a.h)("small",{class:"s-rating-validation-msg"})))}renderProductsRating(){return(0,a.h)("section",{class:"s-rating-step","data-type":"product","data-step-name":"تقييم المنتجات"},this.order.products.map(((t,e)=>(0,a.h)("div",{class:"rating-outer-form s-rating-product","data-stars-error":salla.lang.get("pages.rating.rate_product_stars",{item:t.title})},(0,a.h)("img",{src:t.image,alt:t.title,class:"s-rating-product-img"}),(0,a.h)("div",{class:"flex-1"},(0,a.h)("h3",{class:"s-rating-product-title"}," ",t.title),this.getStarsRating(),(0,a.h)("input",{type:"hidden",name:"order_id",value:this.orderId}),(0,a.h)("input",{type:"hidden",name:`products[${e}][product_id]`,value:t.getOptimusRouteKey}),(0,a.h)("input",{type:"hidden",name:"type",value:"products"}),(0,a.h)("textarea",{"data-product-id":t.id,name:`products[${e}][comment]`,id:`productReview_${t.id}`,class:"s-rating-comment",placeholder:salla.lang.get("pages.rating.write_product_rate")}),(0,a.h)("small",{class:"s-rating-validation-msg"}))))))}renderThanksView(){return(0,a.h)("div",{class:"s-rating-thanks s-rating-hidden"},(0,a.h)("span",{class:"s-rating-thanks-icon sicon-check-circle2"}),(0,a.h)("h3",{class:"s-rating-thanks-title"},salla.lang.get("pages.rating.thanks")),(0,a.h)("div",{class:"s-rating-thanks-msg",innerHTML:this.thanksMsg}),(0,a.h)("a",{href:"#!",onClick:()=>this.hide(),class:"s-rating-thanks-btn"},"عودة إلي تفاصيل الطلب"),(0,a.h)("time",{class:"s-rating-thanks-time"}))}getStarsRating(){return(0,a.h)("form",{class:"s-rating-stars-element"},(0,a.h)("div",{class:"mb-1"},(0,a.h)("input",{type:"hidden",class:"rating_hidden_input",name:"rating",value:""}),[1,2,3,4,5].map((t=>(0,a.h)("button",{type:"submit",class:"btn btn--transparent px-1 text-2xl text-gray-400 btn--star","data-star":t},(0,a.h)("i",{class:"sicon-star2"}))))))}get host(){return(0,a.g)(this)}};r.style=":host{display:block}.unicode{unicode-bidi:plaintext}"}}]);